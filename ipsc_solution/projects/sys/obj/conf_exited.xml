<?xml version="1.0" encoding="utf-8"?>
<root>
  <FlowItem>
    <FlowID>conf_exited</FlowID>
    <FlowName>conf_exited</FlowName>
    <FlowDesc />
    <FlowVer>1.0</FlowVer>
    <CreateDate>2016-06-18T10:25:27+08:00</CreateDate>
    <ModifyDate>2016-09-30T06:33:39+08:00</ModifyDate>
    <DesignVer>2.0</DesignVer>
  </FlowItem>
  <FlowNode>
    <NodeID>1584</NodeID>
    <NodeType>SUBSTART</NodeType>
    <NodeName>子流程开始</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <AffectList>
        <varlist>
          <var>conf_id</var>
        </varlist>
        <varlist>
          <var>action_type_id</var>
        </varlist>
        <varlist>
          <var>chan</var>
        </varlist>
      </AffectList>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>1589</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1589</NodeID>
    <NodeType>SCRIPT</NodeType>
    <NodeName>脚本 conf exited</NodeName>
    <ExtendedProperty>ZoneType=0;ScriptContent=call_map = _gd_['call_map'] # chan =&gt; call_info
conf_map = _gd_['conf_map'] # res_id =&gt; call_info

call_map_r = _gd_['call_map_r'] # res_id =&gt; call_info
conf_map_r = _gd_['conf_map_r'] # res_id -&gt; conf_info

last_err = None
try:
	conf_info = call_info = None
	try:
		conf_info = conf_map[conf_id]
	except KeyError as e:
		raise KeyError('conference id &lt;%s&gt; NOT existed' % conf_id)
	errno, chan_list, mode_list, timeout_list = GetConferList(conf_id, 0)
	if errno &lt;= 0:
		raise RuntimeError("GetConferList(conf_id={}) returns {}".format(conf_id, errno))
	parts = conf_info['parts']
	rm_idx = []
	for i in range(len(chan_list)):
		chan = chan_list[i]
		if chan = parts[i]['chan']:
			rm_idx.insert(0, i)
	for i in rm_idx
		parts.pop(i)
except IvrError as err:
	TraceErr(err)
	last_err = err</ExtendedProperty>
    <PropertySet>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
</root>