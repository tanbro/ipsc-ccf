<?xml version="1.0" encoding="utf-8"?>
<root>
  <FlowItem>
    <FlowID>__term_function</FlowID>
    <FlowName>终端附加功能</FlowName>
    <FlowDesc>系统流程－终端附加功能</FlowDesc>
    <FlowVer>1.0</FlowVer>
    <CreateDate>2008年04月06日 12:14:59</CreateDate>
    <ModifyDate>2009年09月07日 11:23:17</ModifyDate>
    <DesignVer>2.0</DesignVer>
  </FlowItem>
  <FlowNode>
    <NodeID>1046</NodeID>
    <NodeType>SUBSTART</NodeType>
    <NodeName>子流程开始</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <AffectList>
        <varlist>
          <var>termid</var>
        </varlist>
        <varlist>
          <var>termtype</var>
        </varlist>
        <varlist>
          <var>termch</var>
        </varlist>
        <varlist>
          <var>termteleno</var>
        </varlist>
        <varlist>
          <var>isactive</var>
        </varlist>
        <varlist>
          <var>func_flag</var>
        </varlist>
        <varlist>
          <var>agentid</var>
        </varlist>
        <varlist>
          <var>agentstate</var>
        </varlist>
        <varlist>
          <var>src_sessionid</var>
        </varlist>
        <varlist>
          <var>src_talkid</var>
        </varlist>
        <varlist>
          <var>option</var>
        </varlist>
      </AffectList>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>1128</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1049</NodeID>
    <NodeType>DTMFMENU</NodeType>
    <NodeName>按键菜单</NodeName>
    <ExtendedProperty>PrePromptVoice=;ChNo=termch;Timeout=30;IsBreak=1;ValidDtmfStr=dtmfmask;InvalidProcType=;OutKey=;RepeatNum=;VideoFile=;VideoFormat=;PlayVideoVoice=;PlayEndMode=;TimeoutIsPlayEnd=;IsHaveLogo=;LogoFile=;LogoPosLeft=;LogoPosTop=;LogoWidth=;LogoHeight=;LogoTransYUVA=;LogoAlphaBlending=</ExtendedProperty>
    <PropertySet>
      <DynamicVoice />
      <SubTitle />
      <Exit>
        <ExitPort>
          <type>5</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>9</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>4</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>80</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>81</type>
          <targetflow>
          </targetflow>
          <target>1053</target>
        </ExitPort>
        <ExitPort>
          <type>82</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>83</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>84</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>85</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>86</type>
          <targetflow>
          </targetflow>
          <target>1150</target>
        </ExitPort>
        <ExitPort>
          <type>87</type>
          <targetflow>
          </targetflow>
          <target>1154</target>
        </ExitPort>
        <ExitPort>
          <type>88</type>
          <targetflow>
          </targetflow>
          <target>1158</target>
        </ExitPort>
        <ExitPort>
          <type>89</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>90</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>91</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1053</NodeID>
    <NodeType>LET</NodeType>
    <NodeName>赋值</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <letlist />
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1069</NodeID>
    <NodeType>JUDGE</NodeType>
    <NodeName>判断</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <switch>
        <case>
          <expression>isactive == 1</expression>
          <ExitType>101</ExitType>
        </case>
      </switch>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>101</type>
          <targetflow>
          </targetflow>
          <target>1070</target>
        </ExitPort>
        <ExitPort>
          <type>100</type>
          <targetflow>
          </targetflow>
          <target>1076</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1070</NodeID>
    <NodeType>LET</NodeType>
    <NodeName>赋值</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <letlist>
        <let>
          <VarName>dtmfmask</VarName>
          <ZoneType>0</ZoneType>
          <Value>"0123456789*#"</Value>
        </let>
        <let>
          <VarName>voicefile</VarName>
          <ZoneType>0</ZoneType>
          <Value>"systemvoice\term_func_menu1.wav"</Value>
        </let>
        <let>
          <VarName>voicefile</VarName>
          <ZoneType>0</ZoneType>
          <Value>""</Value>
        </let>
      </letlist>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>1049</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1076</NodeID>
    <NodeType>LET</NodeType>
    <NodeName>赋值</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <letlist>
        <let>
          <VarName>dtmfmask</VarName>
          <ZoneType>0</ZoneType>
          <Value>"0123456789"</Value>
        </let>
        <let>
          <VarName>voicefile</VarName>
          <ZoneType>0</ZoneType>
          <Value>"systemvoice\term_func_menu2.wav"</Value>
        </let>
        <let>
          <VarName>voicefile</VarName>
          <ZoneType>0</ZoneType>
          <Value>""</Value>
        </let>
      </letlist>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>1049</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1128</NodeID>
    <NodeType>JUDGE</NodeType>
    <NodeName>判断</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <switch>
        <case>
          <expression>func_flag &lt; 0</expression>
          <ExitType>109</ExitType>
        </case>
        <case>
          <expression>func_flag == 1</expression>
          <ExitType>101</ExitType>
        </case>
        <case>
          <expression>func_flag == 2</expression>
          <ExitType>102</ExitType>
        </case>
        <case>
          <expression>func_flag == 3</expression>
          <ExitType>103</ExitType>
        </case>
        <case>
          <expression>func_flag == 4</expression>
          <ExitType>104</ExitType>
        </case>
        <case>
          <expression>func_flag == 5</expression>
          <ExitType>105</ExitType>
        </case>
        <case>
          <expression>func_flag == 6</expression>
          <ExitType>106</ExitType>
        </case>
        <case>
          <expression>func_flag == 7</expression>
          <ExitType>107</ExitType>
        </case>
        <case>
          <expression>func_flag == 12</expression>
          <ExitType>108</ExitType>
        </case>
      </switch>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>109</type>
          <targetflow>
          </targetflow>
          <target>1069</target>
        </ExitPort>
        <ExitPort>
          <type>101</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>102</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>103</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>104</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>105</type>
          <targetflow>
          </targetflow>
          <target>1158</target>
        </ExitPort>
        <ExitPort>
          <type>106</type>
          <targetflow>
          </targetflow>
          <target>1150</target>
        </ExitPort>
        <ExitPort>
          <type>107</type>
          <targetflow>
          </targetflow>
          <target>1154</target>
        </ExitPort>
        <ExitPort>
          <type>108</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>100</type>
          <targetflow>
          </targetflow>
          <target>1069</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1154</NodeID>
    <NodeType>LET</NodeType>
    <NodeName>赋值</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <letlist />
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>1155</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1155</NodeID>
    <NodeType>SCRIPT</NodeType>
    <NodeName>脚本</NodeName>
    <ExtendedProperty>ZoneType=0;ScriptContent=sessionid = FindSessionID(1)
if sessionid &gt; 0:
	StopSessionRing(sessionid)</ExtendedProperty>
    <PropertySet>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1150</NodeID>
    <NodeType>JUDGE</NodeType>
    <NodeName>判断</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <switch>
        <case>
          <expression>src_sessionid &gt; 0</expression>
          <ExitType>101</ExitType>
        </case>
      </switch>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>101</type>
          <targetflow>
          </targetflow>
          <target>1151</target>
        </ExitPort>
        <ExitPort>
          <type>100</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1151</NodeID>
    <NodeType>SCRIPT</NodeType>
    <NodeName>脚本</NodeName>
    <ExtendedProperty>ZoneType=0;ScriptContent=confid=TermGetTalkConfID(src_sessionid,src_talkid)
res,mode,pmch,timeout,ismainch,volume,state=GetConferInfo(confid,termch,1)
Trace("&gt;&gt;&gt;&gt; confid=%d"%confid)
Trace("&gt;&gt;&gt;&gt; %s"%(str([res,mode,pmch,timeout,ismainch,volume,state])))
if res &gt; 0 and mode &gt;= 6 and mode &lt;= 8:
	ChangeConferMode(confid,[termch,pmch],1,-1,0)
</ExtendedProperty>
    <PropertySet>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1158</NodeID>
    <NodeType>JUDGE</NodeType>
    <NodeName>判断</NodeName>
    <ExtendedProperty>
    </ExtendedProperty>
    <PropertySet>
      <switch>
        <case>
          <expression>src_sessionid &gt; 0</expression>
          <ExitType>101</ExitType>
        </case>
      </switch>
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>101</type>
          <targetflow>
          </targetflow>
          <target>1162</target>
        </ExitPort>
        <ExitPort>
          <type>100</type>
          <targetflow>
          </targetflow>
          <target>1160</target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1160</NodeID>
    <NodeType>PLAY</NodeType>
    <NodeName>放音</NodeName>
    <ExtendedProperty>PrePromptVoice=;ChNo=;BreakDtmfStr=;Mode=0;OutKey=;VideoFile=0;VideoFormat=0;PlayVideoVoice=;PlayEndMode=;IsHaveLogo=;LogoFile=;LogoPosLeft=;LogoPosTop=;LogoWidth=;LogoHeight=;LogoTransYUVA=;LogoAlphaBlending=</ExtendedProperty>
    <PropertySet>
      <DynamicVoice />
      <SubTitle />
      <Exit>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>5</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
  <FlowNode>
    <NodeID>1162</NodeID>
    <NodeType>TERMCONN</NodeType>
    <NodeName>连接终端</NodeName>
    <ExtendedProperty>SessionID=src_sessionid;MainChTermID=termid;WaitMode=1;ChTermIDList=;ConnMode=0;ConnDuration=3600;Option=;OutTermID=;OutTalkID=;OutExitData=</ExtendedProperty>
    <PropertySet>
      <Exit>
        <ExitPort>
          <type>5</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>4</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>2</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
        <ExitPort>
          <type>1</type>
          <targetflow>
          </targetflow>
          <target>
          </target>
        </ExitPort>
      </Exit>
    </PropertySet>
  </FlowNode>
</root>